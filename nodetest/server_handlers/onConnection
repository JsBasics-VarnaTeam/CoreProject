module.exports = (io) => {
    var clientCount = 0;
    // var messages = [];
    var clients = [];

    // for each client there will be separate keep alive connection
    io.on('connection', function (client) {
        let accepted = false;
        client.on('username', (data) => {
            clients[client.id] = data.username

            io.to(client.id).emit('accepted', 'welcome')
            accepted = true;
            clientCount++
            console.log('client with id ' + client.id + ' and username ' + data.username + ' connected');

        });


        // Server side client kick after 6 sec
        // if client has no username
        setTimeout(
            () => {
                if(!accepted) {
                    if(client) {
                        io.to(client.id).emit('kick', 'You have been kicked cuz u have no username')
                        client.disconnect()
                    }
                }
            }, 6000
        )

        // main events should reside here


        // for example onPosReceived


        // or onAttack etc.


        client.on('disconnect', function() {
            console.log('client with id ' + client.id + ' disconnected')
            clientCount--
        })
    });


    // Testing functions
    function sendTime () {
        io.emit('time', {time: new Date().toJSON()})
    }

    setInterval(sendTime, 5000)

    setInterval(function () {
        console.log(clientCount)
    }, 10000)
}
